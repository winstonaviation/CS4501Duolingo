{% extends "base.html" %}
{% load dict_extras %}

{% block title %}{{ course.title }} · Duolingo{% endblock %}

{% block content %}
<div class="text-center" style="margin-bottom: 40px;">
  <h2>{{ course.title }}</h2>
  <p style="font-size: 18px; color: #777; max-width: 700px; margin: 16px auto;">
    {{ course.description|default:"Master the basics and beyond!" }}
  </p>
  <div style="margin-top: 16px;">
    <span style="background: var(--duo-gray); padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 600;">
      {{ course.from_language }} → {{ course.to_language }}
    </span>
  </div>
</div>

<h3 class="text-center">Learning Path</h3>
<ul class="lesson-path">
{% for ls in lessons %}
  {% if user.is_authenticated %}
    {% with lp=progress_map|get_item:ls.id %}
      <li class="lesson-node {% if lp and lp.completed %}completed{% endif %}">
        <div class="lesson-icon">
          {% if lp and lp.completed %}★{% else %}{{ forloop.counter }}{% endif %}
        </div>
        <div class="lesson-info">
          <h4>{{ ls.title }}</h4>
          {% if lp and lp.completed %}
            <span class="lesson-status completed">Completed ✓</span>
          {% else %}
            <span class="lesson-status">Ready</span>
          {% endif %}
          <div style="margin-top: 12px;">
            <a href="{% url 'lesson_start' ls.id %}" class="btn btn-small">
              {% if lp and lp.completed %}Practice Again{% else %}Start Lesson{% endif %}
            </a>
          </div>
        </div>
      </li>
    {% endwith %}
  {% else %}
    <li class="lesson-node">
      <div class="lesson-icon">{{ forloop.counter }}</div>
      <div class="lesson-info">
        <h4>{{ ls.title }}</h4>
        <div style="margin-top: 12px;">
          <a href="/admin/login/?next={% url 'lesson_start' ls.id %}" class="btn btn-small">
            Login to Start
          </a>
        </div>
      </div>
    </li>
  {% endif %}
{% empty %}
  <li style="text-align: center; padding: 40px;">
    <p style="font-size: 18px; color: #777;">No lessons available yet.</p>
    {% if user.is_staff %}
      <a href="/admin/core/lesson/add/" class="btn mt-4">Add Lessons</a>
    {% endif %}
  </li>
{% endfor %}
</ul>
{% endblock %}
