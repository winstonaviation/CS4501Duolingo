{% extends "base.html" %}
{% block title %}Lesson Complete! · Multilingo{% endblock %}
{% block content %}
<div class="completion-container">
  <div class="completion-icon">
    {% if perfect_count == total %}
      🏆
    {% elif score >= total %}
      🌟
    {% else %}
      🎉
    {% endif %}
  </div>

  <h2 style="font-size: 48px; margin-bottom: 16px;">
    {% if perfect_count == total %}
      Perfect Lesson!
    {% elif score == total %}
      Lesson Complete!
    {% else %}
      Good Effort!
    {% endif %}
  </h2>
  
  <p style="font-size: 20px; color: #777;">
    You finished <strong>{{ lesson.title }}</strong>!
  </p>

  <!-- Detailed Score Display -->
  <div class="score-display">
    <div style="color: #777; font-size: 18px; margin-bottom: 8px;">Your Score</div>
    <div class="score" style="font-size: 56px; font-weight: 900; color: var(--duo-text); margin-bottom: 8px;">
      {{ score }}/{{ total }}
    </div>
    
    <!-- Score Breakdown -->
    <div style="margin-bottom: 24px;">
      {% if perfect_count > 0 %}
        <div style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; background: #d7ffb8; border-radius: 8px; margin: 4px;">
          <span style="font-size: 24px;">✓</span>
          <span style="font-weight: 700; color: var(--duo-green-dark);">
            {{ perfect_count }} Perfect
          </span>
        </div>
      {% endif %}
      
      {% if corrected_count > 0 %}
        <div style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; background: #fff9e6; border-radius: 8px; margin: 4px;">
          <span style="font-size: 24px;">⭐</span>
          <span style="font-weight: 700; color: var(--duo-orange);">
            {{ corrected_count }} Corrected
          </span>
        </div>
      {% endif %}
      
      {% if failed_count > 0 %}
        <div style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; background: #ffd2d2; border-radius: 8px; margin: 4px;">
          <span style="font-size: 24px;">✗</span>
          <span style="font-weight: 700; color: var(--duo-red);">
            {{ failed_count }} Incorrect
          </span>
        </div>
      {% endif %}
    </div>

    <!-- Percentage and Performance Message -->
    <div class="total" style="font-size: 20px; color: var(--duo-text-light); margin-bottom: 24px;">
      {% widthratio score total 100 %}% Correct
      {% if perfect_count == total %}
        • All first-try! 🔥
      {% elif corrected_count > 0 %}
        • {{ corrected_count }} corrected on retry
      {% endif %}
    </div>

    <!-- XP Earned -->
    <div style="margin-top: 24px; padding: 20px; background: #fff9e6; border-radius: 12px;">
      <div style="display: flex; align-items: center; justify-content: center; gap: 12px; font-size: 20px; font-weight: 700; color: var(--duo-orange);">
        <span style="font-size: 32px;">⭐</span>
        <span>+{{ completion_xp }} XP Bonus</span>
      </div>
    </div>

    <!-- Performance Badge -->
    {% if perfect_count == total %}
      <div style="margin-top: 24px; padding: 20px; background: linear-gradient(135deg, #ffd900 0%, #ffb800 100%); border-radius: 12px; color: #5c4200; font-weight: 700; box-shadow: 0 4px 0 #d99f00;">
        <div style="font-size: 32px; margin-bottom: 8px;">🏆</div>
        <div style="font-size: 20px; font-weight: 900;">FLAWLESS VICTORY!</div>
        <div style="font-size: 14px; opacity: 0.9; margin-top: 4px;">Every answer correct on first try!</div>
      </div>
    {% elif score == total %}
      <div style="margin-top: 24px; padding: 16px; background: #d7ffb8; border-radius: 12px; color: var(--duo-green-dark); font-weight: 700;">
        ⭐ Great Recovery! You got everything right!
      </div>
    {% elif score >= total|floatformat:0|add:"-1" %}
      <div style="margin-top: 24px; padding: 16px; background: #fff3cd; border-radius: 12px; color: #856404; font-weight: 700;">
        🌟 Almost there! Keep practicing!
      </div>
    {% endif %}
  </div>

  <!-- Stats Grid -->
  <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin: 32px 0; max-width: 500px;">
    <div style="text-align: center; padding: 16px; background: white; border: 2px solid var(--duo-gray); border-radius: 12px;">
      <div style="font-size: 32px; margin-bottom: 8px;">🔥</div>
      <div style="font-size: 20px; font-weight: 700; color: var(--duo-text);">{{ profile.streak_days }}</div>
      <div style="font-size: 12px; color: var(--duo-text-light); font-weight: 600;">Day Streak</div>
    </div>

    <div style="text-align: center; padding: 16px; background: white; border: 2px solid var(--duo-gray); border-radius: 12px;">
      <div style="font-size: 32px; margin-bottom: 8px;">⭐</div>
      <div style="font-size: 20px; font-weight: 700; color: var(--duo-text);">{{ profile.xp }}</div>
      <div style="font-size: 12px; color: var(--duo-text-light); font-weight: 600;">Total XP</div>
    </div>

    <div style="text-align: center; padding: 16px; background: white; border: 2px solid var(--duo-gray); border-radius: 12px;">
      <div style="font-size: 32px; margin-bottom: 8px;">❤️</div>
      <div style="font-size: 20px; font-weight: 700; color: var(--duo-text);">{{ profile.hearts }}</div>
      <div style="font-size: 12px; color: var(--duo-text-light); font-weight: 600;">Hearts Left</div>
    </div>
  </div>

  <div style="display: flex; gap: 16px; justify-content: center; flex-wrap: wrap;">
    <a href="{% url 'lesson_start' lesson.id %}" class="btn btn-secondary">
      Practice Again
    </a>
    <a href="{% url 'course_detail' lesson.unit.section.course.slug %}" class="btn">
      Continue Learning
    </a>
  </div>

  <!-- Learning Tips -->
  {% if corrected_count > 0 or failed_count > 0 %}
    <div style="margin-top: 48px; padding: 24px; background: white; border-radius: 16px; box-shadow: var(--shadow); max-width: 500px;">
      <h4 style="margin-bottom: 16px; display: flex; align-items: center; gap: 8px; justify-content: center;">
        <span style="font-size: 28px;">💡</span>
        <span>Keep Improving!</span>
      </h4>
      <div style="color: #777; line-height: 1.8; text-align: left; font-size: 14px;">
        {% if corrected_count > 0 %}
          <p style="margin-bottom: 12px;">
            ✅ You corrected <strong>{{ corrected_count }}</strong> answer{{ corrected_count|pluralize }} - that shows great learning!
          </p>
        {% endif %}
        {% if failed_count > 0 %}
          <p style="margin-bottom: 12px;">
            📚 Review the <strong>{{ failed_count }}</strong> question{{ failed_count|pluralize }} you missed by practicing this lesson again.
          </p>
        {% endif %}
        <p style="margin-bottom: 12px;">
          💪 <strong>Pro tip:</strong> Try to get all answers right on the first try for maximum XP!
        </p>
        <p>
          🎯 Perfect lessons earn you special achievements and quest progress.
        </p>
      </div>
    </div>
  {% endif %}

  <!-- Motivational Message -->
  <div style="margin-top: 48px; padding: 24px; background: white; border-radius: 16px; box-shadow: var(--shadow); max-width: 500px;">
    <h4 style="margin-bottom: 16px; display: flex; align-items: center; gap: 8px; justify-content: center;">
      <span style="font-size: 28px;">🐬</span>
      <span>Keep Your Streak Going!</span>
    </h4>
    <p style="color: #777; line-height: 1.6;">
      Come back tomorrow to continue your learning journey and maintain your {{ profile.streak_days }}-day streak. Consistency is the key to mastery!
    </p>
  </div>
</div>
{% endblock %}